if (window.console != undefined) {<br>    console.log('Microweber Javascript Edit Page Framework Loaded');<br>}<br><br>$.dataFind = function(data, findwhat){<br>       var div = document.createElement('div');<br>       div.innerHTML = data;<br>       div.className = 'xhidden';<br>       document.body.appendChild(div);<br>       setTimeout(function(){$(div).destroy()}, 5);<br>       return $(div).find(findwhat)<br>    }<br><br><br><br><br>function init_edits(){<br>    <br>    $(".editblock").live("click", function() {<br><br><br>        var id = $(this).attr("id");<br>         var rel = $(this).attr("rel");<br><br>         var field = $(this).attr("field");<br>         if(field == undefined){<br>             field = '';<br>         }<br><br><br><br>        if( $(this).hasClass('editblock')){<br>            $tag = 'editblock'<br>        }<br><br><br><br>        if( $(this).hasClass('edit')){<br>            $tag = 'edit'<br>        }<br><br><br>         if($tag == undefined){<br>             $tag = '';<br>         }<br><br>if (load_editblock_history !=undefined ) {<br>  $page_json = get_page_json();<br><br>  load_editblock_history(id, rel, $page_json.page.id,$tag, field) ;<br>  }<br>});<br>$(".edit").live("click", function() {<br><br><br>        var id = $(this).attr("id");<br>         var rel = $(this).attr("rel");<br><br>         var field = $(this).attr("field");<br>         if(field == undefined){<br>             field = '';<br>         }<br><br><br><br>        if( $(this).hasClass('editblock')){<br>            $tag = 'editblock'<br>        }<br><br><br><br>        if( $(this).hasClass('edit')){<br>            $tag = 'edit'<br>        }<br><br><br>         if($tag == undefined){<br>             $tag = '';<br>         }<br><br>if (load_editblock_history !=undefined ) {<br>  $page_json = get_page_json();<br><br>  load_editblock_history(id, rel, $page_json.page.id,$tag, field) ;<br>  }<br>});<br>}<br><br><br>$(document).ready(function() {<br>    <br>    <br> <br>    if(typeof window.parent.mw_edit_init == 'function'){<br>    window.parent.mw_edit_init(window.location.href);<br>    }<br><br><br> $("edit").each(function(){<br>                 $(this).attr("id", "edit_" + mw.id());<br>               })<br><br><br>                    init_edits();<br>                 <br><br><br><br><br>               <br>/*   $.post('<? print site_url("admin/toolbar") ?>', function(data){<br><br>      var toolbar = $.dataFind(data, "#mw_toolbar");<br>      $(document.body).prepend(toolbar);<br>  });*/<br><br><br><br><br>//$(".module").append("<div class='mwedit'></div>"); //throws an error in ie<br><br>    $(".module").hover(function(){<br>        $(this).find(".mwedit").show()<br>    }, function(){<br>         $(this).find(".mwedit").hide()<br>    });<br><br><br><br>    $(".module").each(function(){<br>        <br>        <br>        $(this).attr("id", "module_id_" + mw.id());<br>        <br>        <br>        <br>    })<br><br><br>    $(".module").live("click", function(event) {<br>           <br>         var edit = $(this).attr("edit");<br>         var rel = $(this).attr("rel");<br>         <br><br><br>          <br>         <br>         <br>         if(edit ==undefined){<br>             <br>         } else {<br><br><br>         if($("#enable_browse").is(":checked")){<br>               mw.prevent(event);<br><br><br><br>           <br>           if (load_editblock_history !=undefined ) {<br><br>              var parent_rel = $(this).parents(".editblock:first").attr("rel");<br>              var parent_id = $(this).parents(".editblock:first").attr("id"); <br>               <br><br>               $page_json = get_page_json();<br>               <br>               load_editblock_history(parent_id, parent_rel, $page_json.page.id, 'editblock') ;<br>               <br>               <br><br>               }<br>          <br><br>          // alert(edit);<br><br>           var id = $(this).attr("id");<br>           <br>           var no_admin = $(this).attr("no_admin");<br><br>           try {<br>               $(this).removeAttr('contentEditable');<br>             } catch (e) {<br>                 $(this).attr('contentEditable', false);<br>             }<br><br><br>             if(no_admin == undefined){<br>           $url = '<? print site_url("api/module") ?>/admin:true/base64:'+edit;<br>           // alert($url);<br>           // callIframe<br><br>           call_edit_module_iframe($url, id) ;<br>             }<br><br>           }<br>           <br>         }<br><br>        });<br><br><br><br><br>$(window).load(function(){<br>        var editblock_ids = "";<br><br>        var editblocklength = $(".editblock").length-1;<br>        $(".editblock").each(function(i){<br>           var id = $(this).attr("id");<br><br>             if(editblock_ids==""){<br>             editblock_ids = "#" +id;<br>               }<br><br><br><br>           if(editblock_ids!=""){<br>            editblock_ids = editblock_ids + ", #" +id;<br>           }<br><br><br>        });<br><br>        <br> <br><br>        $(".module").each(function(){<br>           if($(this).find(".module_handle").length==0){<br>             var bar = ''<br>             +'<div class="module_edit_bar">'<br>             +'<span class="module_edit_bar_handle">&nbsp;</span>'<br>             +'<span class="module_edit_bar_delete">Delete</span>'<br>             +"</div>";<br><br>             $(this).append(bar)<br>           }<br>        });<br><br><br>        $(".module_edit_bar_delete").click(function(event){<br>            mw.prevent(event);<br>            var parent = $(this).parents(".module:first");<br>            mw.modal.confirm({<br>              html:"Are you sure you want to delete this module?",<br>              yes:function(){<br>                parent.remove();<br>                mw.modal.alert("Module deleted");<br>              }<br>            })<br>        });<br><br><br><br><br>        $(".editblock").each(function(){<br>          $(this).sortable({<br>             connectWith:editblock_ids,<br>             items:".module",<br>             cancel: ".module .module",<br>             handle:".module_edit_bar_handle",<br>             receive:function(event, ui){<br><br>               var mw1 = ui.item.find("textarea").val();<br>               $(".bar_module").not("#module_bar .bar_module").replaceWith(mw1);<br><br>                  $(".editblock").each(function(){<br>                      var id =  $(this).attr("id");<br>                      save_editblock(id);<br>                  })<br>              }<br>              // handle:".mwedit"<br>          })<br>          //$(this).disableSelection();<br><br>        });<br>        $(".edit").droppable({<br>           drop: function(event, ui) {<br>              var mw1 = ui.draggable.find("textarea").val();<br>              $(".to_here").after(mw1);<br>              $(".editblock").each(function(){<br>                      var id =  $(this).attr("id");<br>                      save_editblock(id);<br>                      //mw.saveALL();<br>                  })<br>           }<br>        });<br>        $(".edit *").hover(function(event){<br>          mw.prevent(event)<br>          $(".edit *").removeClass("to_here");<br>          $(this).addClass("to_here");<br>        }, function(){<br><br>        })<br><br><br><br>});<br><br><br>       /* $(".editblock").sortable({<br>            connectWith:".editblock",<br>           items:".module",<br>            receive:function(){<br>                $(".editblock").each(function(){<br>                    var id =  $(this).attr("id");<br>                    save_editblock(id);<br>                })<br>            }<br>            // handle:".mwedit"<br>        }).disableSelection(); */<br>    }); //end doc ready<br><br>var $curent_edit_element_id<br><br>function load_editblock_history($id,$rel, $page_id, $tag, $field) {<br>    <br>     data1 = {}<br>       data1.module = 'admin/mics/edit_block_history';<br>        data1.id = $id;<br>        if($rel != undefined){<br>        data1.rel = $rel;<br>        }<br>        if($page_id != undefined){<br>        data1.page_id = $page_id;<br>        }<br>        <br>        if($tag != undefined){<br>            data1.tag = $tag;<br>            }<br>        <br>        if($field != undefined){<br>            data1.field = $field;<br>            }<br>        <br>       $.ajax({<br>      url: '<? print site_url('api/module') ?>',<br>       type: "POST",<br>          data: data1,<br><br>          async:true,<br><br>      success: function(resp) {<br><br>       $('#mw_block_history').html(resp);<br><br>     <br><br>      }<br>        });<br>        <br>    <br>    <br>    <br>    <br>    <br>}<br><br>function load_field_from_history_file($id, $base64fle){<br><br><br>    $.ajax({<br>          type: 'POST',<br>          url: '<? print site_url("api/content/load_history_file") ?>',<br>          data: { history_file: $base64fle },<br>          success: function(data) {<br>               $("#"+$id).html(data);<br>          }<br>        })<br>    <br>    <br>}<br><br>function load_editblock($id, $history_file) {<br>    $page_json = get_page_json();<br>    <br>    $rel = $(".editblock#"+$id).attr('rel');<br>    <br>     if ( typeof $history_file != 'undefined' ) {<br>         $history_file = $history_file;<br>     } else {<br>         $history_file = false; <br>     }<br>    <br>    <br>    $.ajax({<br>          type: 'POST',<br>          url: '<? print site_url("api/content/load_block") ?>',<br>          data: { id: $id, rel:$rel , page_id: $page_json.page.id, history_file:$history_file },<br>          success: function(data) {<br>              // alert(data);<br>               $(".editblock#"+$id).html(data);<br>               <br>             <br>               <br>               if ( typeof load_editblock_history != 'undefined' ) {<br>               load_editblock_history($id, $rel, $page_json.page.id) ;<br>               }<br>               <br>               <br>               <br>               <br>               $(".module").each(function(){<br>                 $(this).attr("id", "module_id_" + mw.id());<br>               })<br>       //        init_edits();<br><br><br>          }<br>        })<br>        <br>        <br>        <br>}<br><br>function get_page_json() {<br>    if ( typeof get_page_json.page == 'undefined' ) {<br>        $page_data = window.location.href ;<br>        $.ajax({<br>            type: 'POST',<br>            url: $page_data,<br>            data: { format: 'json'},<br>           async:false,<br>           dataType: "json", <br>            success: function(data) {<br>            get_page_json.page = data;<br><br>            }<br>          })<br>    }<br><br>    <br>return get_page_json.page;<br>    <br>}    <br>function save_editblock($id) {<br>    // alert($id);<br>    $(".module_edit_bar").remove();<br>    $page_json = get_page_json();<br>    //alert($page_json);<br><br><br><br><br>    <br><br>    <br>    var clone =  $(".editblock#"+$id).find(".mw_save").clone(true);<br>    $(".editblock#"+$id).find(".mw_save").remove();<br>    $test = $(".editblock#"+$id).html();<br>    <br>    $rel = $(".editblock#"+$id).attr('rel');<br>    <br>    $(".editblock#"+$id).append(clone)<br>    <br>    <br>    <br>    <br><br>    $.ajax({<br>          type: 'POST',<br>          url: '<? print site_url("api/content/save_block") ?>',<br>          data: { id: $id, html:$test , rel:$rel ,page_id: $page_json.page.id},<br>          async:false,<br>          success: function(data) {<br>              // alert(data);<br>              load_editblock($id);<br><br>          }<br>        })<br>//init_edits();<br>}<br><br>function call_edit_module_iframe(url, id) {<br> if(id){<br>    url = url + 'element_id:'+id;<br>    $curent_edit_element_id=id;<br> }<br>        var call_iframe = mw.modal.iframe({src:url, width:700, overlay:true, height:500, id:"module_edit_iframe"});<br><br>}<br><br><br>function update_module_element($new_value) {<br>    <br>    $temp = $('#'+$curent_edit_element_id).parents(".editblock") .attr("id")<br>    //alert($temp);<br>      $('#'+$curent_edit_element_id).attr("base64_array", $new_value);<br>    save_editblock($temp);<br><br>      mw.modal.close();<br>      <br>}<br><br>mw.saveALL = function(){<br>    <br>    nic_save_all(function(){<br>        <br>        $(".editblock").each(function(){<br>            var id = $(this).attr("id");<br>            save_editblock(id);<br>        });<br>        <br>    //    init_edits();<br>    });<br>    <br>    <br>    <br><br><br><br><br>}